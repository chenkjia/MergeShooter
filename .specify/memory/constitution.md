# 跨平台小游戏开发章程

## 核心原则

### 一、 高质量与可维护的代码

- **统一语言标准**: 项目统一使用现代 JavaScript (ES6+) 进行开发，以利用其最新特性提高代码可读性和效率。
- **模块化设计**: 所有功能都应拆分为高内聚、低耦合的模块。核心游戏逻辑、UI组件和平台适配层必须清晰分离。
- **代码风格一致性**: 引入并强制使用 ESLint 等代码检查工具，遵循统一的、严格的编码规范，确保代码风格一致。
- **清晰的命名**: 变量、函数、类和文件名必须遵循统一的命名约定（例如，驼峰式命名法），做到见名知意。
- **中文注释**: 项目所有代码注释（包括块注释、行内注释、JSDoc等）必须使用中文编写，以提高代码的可读性和团队协作效率。
- **状态管理**: 对于复杂、多步骤的逻辑（如战斗流程、新手引导），应优先使用有限状态机（FSM）进行建模和管理，以确保逻辑的清晰性和可预测性。项目统一使用 XState 作为状态管理库，严禁引入或使用 Redux。
- **函数式编程**: 鼓励采用函数式编程范式，以增强代码的健壮性和可维护性。
    - **纯函数优先**: 核心逻辑和数据处理函数应尽可能设计为纯函数（Pure Functions），即相同的输入始终返回相同的输出，且无任何副作用。
    - **不可变性 (Immutability)**: 避免直接修改对象或数组。对于状态的变更，应返回一个新的对象或数组，而不是在原地修改。
    - **避免副作用 (Side Effects)**: 将带有副作用的代码（如网络请求、DOM 操作、日志记录）与核心纯逻辑分离，集中管理。

### 二、 统一的跨平台适配层

- **API 隔离**: 严禁在核心游戏逻辑和UI层直接调用任何平台相关的 API（如 `wx.*` 或 `tt.*`）。
- **统一适配器**: 所有的平台能力调用（如登录、支付、分享、广告、文件系统等）都必须通过项目中的 `adapter.js` 适配层进行。
- **优雅降级**: 当某个功能在一个平台上不可用时，适配层应提供优雅降级方案或明确的提示，而不是直接报错。

### 三、 统一渲染层：Canvas 2D

- **渲染方式统一**: 项目统一使用原生 `CanvasRenderingContext2D` 进行绘制，提供精灵、文本与基础几何图形能力。严禁引入或依赖第三方渲染引擎（如 Pixi.js）。
- **平台适配**: 在抖音/微信小游戏环境下，通过适配层提供 `canvas`（如 `tt.createCanvas()`），仅在适配层内处理窗口尺寸、像素比与缩放，业务层不直接调用平台 API。
- **资源加载**: 统一使用 `Image` 对象进行图片资源管理，所有资源路径置于 `src/assets` 下，并以键值方式访问。
- **事件模型**: 交互统一采用平台触摸事件转发至业务层，禁止混用 DOM 事件。

### 三、 全面的测试标准

- **单元测试**: 核心算法、状态管理和工具函数等不依赖平台环境的纯逻辑模块，必须编写单元测试，确保其正确性。
- **集成测试**: 模块之间，特别是游戏逻辑与适配器之间的交互，需要进行集成测试，以验证其协作的稳定性。
- **发布前手动测试**: 每个版本发布前，必须在微信和抖音两个平台的真实设备（覆盖主流iOS和Android机型）上，根据预定义的测试用例清单完成一轮完整的功能回归测试。

### 四、 一致的用户体验与性能

- **视觉与交互一致性**: 游戏的核心UI、动画和交互反馈在两个平台上必须保持高度一致，为用户提供无差别的核心体验。
- **性能预算**:
    - **启动时间**: 首次加载时间在标准网络环境下必须小于3秒。
    - **帧率 (FPS)**: 游戏运行时必须稳定在 60 FPS，在复杂场景下不得低于 45 FPS。
    - **内存占用**: 在中端机型上，游戏内存占用峰值应控制在 200MB 以内。
- **资源优化**: 所有美术和音频资源在上线前必须经过压缩优化。图片优先使用 WebP 等高效格式，并根据需要应用图集（Sprite Sheet）技术。
- **图片资源管理**: 所有图片资源在使用前必须复制到 `/src/assets` 目录中，确保资源路径统一管理和正确加载。严禁直接引用外部路径的图片资源。统一以 `Image` 资源管理，不依赖第三方纹理类型。

## 开发工作流

- **代码审查 (Code Review)**: 所有新代码在合入主分支前，必须经过至少一名其他成员的审查。审查内容包括功能实现、代码风格以及是否遵循本章程。
- **分支管理**: 遵循 Git Flow 或类似的分支管理策略，功能开发、Bug修复均在独立的分支上进行，保持主分支的稳定和可发布状态。

## 与AI助手协作

- **沟通语言**: 与AI助手的所有对话都必须使用中文。
- **编码格式**: 与AI助手的所有交互内容，包括代码和文本，都必须使用 UTF-8 编码，以确保数据传输的准确性。

## 治理

- 本章程是项目开发的最高准则，其优先级高于任何个人偏好或临时约定。
- 对本章程的任何修订都必须经过团队讨论，并以书面形式记录修订原因和具体内容。

**版本**: 1.0.0 | **批准日期**: 2024-11-29 | **上次修订**: 2024-11-29
